<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>datum</title>
  <link rel="stylesheet" href="fonts.css">
  <link rel="stylesheet" href="styles.css">
  <style id="grid-headers-dynamic-styles"></style>
  <style id="density-dynamic-styles"></style>
  <script src="lib/jquery-3.7.1.min.js"></script>
  <script src="yaml/dist/index.js"></script>
  <script src="utils.js"></script>
  <script src="main.js"></script>
  <script defer src="lib/alpinejs.min.js"></script>
  <script defer src="shoelace/dist/index.js"></script>
  <link rel="stylesheet" href="shoelace/dist/bundle.css">

  <link rel="icon" href="public/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" sizes="180x180" href="public/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="public/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="public/favicon-16x16.png">
  <link rel="manifest" href="public/site.webmanifest">
  <link rel="mask-icon" href="public/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="theme-color" content="#ffffff">
</head>

<body class="sl-theme-dark">
  
<main x-data="{
  get sections()          { return $store.grid.sections; },
  get rowCount()          { return $store.grid.rowCount; },
  get fromYear()          { return $store.grid.fromYear; },
  get toYear()            { return $store.grid.toYear; },
  get gridShown()         { return $store.grid.gridShown; },
  get abbreviateSprints() { return $store.grid.abbreviateSprints; },
  egSprintStart: [2024, 1, 1],
  egSprintIndex: 1,
  sprintLength: 14,
  todayDate: new Date(),
  get lastColumn() { return column(this.fromYear, this.toYear, 12, 31); }
}">
  <sl-split-panel vertical position="75" snap="100%">

  <div slot="start" id="grid" class="grid" x-bind:style="`grid-template-rows: repeat(${rowCount}, var(--row-height)) auto; display: ${gridShown ? 'grid' : 'none'};`">

    <!-- dummy div for measuring the width of the grid -->
    <div id="dummy-full-width-grid-row" x-bind:style="`grid-row: 1; grid-column: 1 / ${lastColumn + 1}`"></div>

    <!-- dates -->
    <template x-for="(year, yearIndex) in range(fromYear, toYear)">
        <div style="display: contents;">
            <!-- years -->
            <div x-bind:style="`grid-row: 1; grid-column: ${column(fromYear, year, 1, 1)} / ${column(fromYear, year, 12, 31) + 1}; background: var(--years-color);`">
              <span class="sticky-against-row-headers" x-text="year"></span>
            </div>
            <!-- months and days -->
            <template x-for="month in range(1, 12)">
                <div style="display: contents;">
                    <!-- month names -->
                    <div x-bind:style="`position: relative; grid-row: 2; grid-column: ${column(fromYear, year, month, 1)} / ${column(fromYear, year, month, daysInMonth(year, month)) + 1}; background: var(--month-color);`">
                      <span class="sticky-against-row-headers" x-text="monthNames[month - 1]"></span>
                    </div>
                    <!-- border for each month -->
                    <div x-bind:style="`z-index: 100; grid-column: ${column(fromYear, year, month, 1)}; grid-row: 4 / -1; ${yearIndex === 0 && month === 1 ? '' : 'border-left: 1px solid var(--month-color);'}`"></div>
                    <!-- row backgrounds for day columns -->
                    <div x-bind:style="`grid-row: 4; grid-column: ${column(fromYear, year, month, 1)} / ${column(fromYear, year, month, daysInMonth(year, month)) + 1}; background: var(--days-color);`"></div>
                    <div x-bind:style="`grid-row: 5; grid-column: ${column(fromYear, year, month, 1)} / ${column(fromYear, year, month, daysInMonth(year, month)) + 1}; background: var(--weekday-color);`"></div>
                    <!-- days in month -->
                    <template x-for="day in range(1, daysInMonth(year, month))">
                      <div x-bind:class="`day-column-header-container ${day === 1 ? 'day-column-header-container-first' : ''}`" style="display: contents;">
                        <!-- date -->
                        <div x-bind:style="`grid-column: ${column(fromYear, year, month, day)}; grid-row: 4; z-index: 50;`">
                          <div class="day-column-header-text" x-text="day"></div>
                        </div>
                        <!-- day of week -->
                        <div x-bind:style="`grid-column: ${column(fromYear, year, month, day)}; grid-row: 5; z-index: 50;`">
                          <div class="day-column-header-text" x-text="weekday(year, month, day)[0]"></div>
                        </div>
                        <!-- background for weekends -->
                        <template x-if="isWeekend(year, month, day)">
                          <div class="day-of-week-column-header" x-bind:style="`grid-column: ${column(fromYear, year, month, day)}; grid-row: 6 / -1; background: var(--weekend-color);`"></div>
                        </template>
                      </div>
                    </template>
                </div>
            </template>
        </div>
    </template>

    <!-- sprints -->
    <template x-for="(sprint, sprintIndex) in sprints(fromYear, toYear, egSprintStart, egSprintIndex, sprintLength)">
      <div style="display: contents;">
        <!-- title -->
        <div x-bind:style="`grid-row: 3; grid-column: ${sprint.start} / ${sprint.end + 1}; background: var(--sprint-color);`">
          <span x-bind:class="`sprint-header-text ${abbreviateSprints ? 'abbreviated' : ''} ${sprint.start === 2 ? 'first-sprint-header-text' : ''} ${sprint.end === lastColumn ? 'last-sprint-header-text' : ''} sticky-against-row-headers`" x-text="(abbreviateSprints ? '' : 'Sprint ') + sprint.index"></span>
        </div>
        <!-- border -->
        <div x-bind:style="`z-index: 50; grid-column: ${sprint.start} / ${sprint.end + 1}; grid-row: 6 / -1; ${sprintIndex === 0 ? '' : 'border-left: 1px solid var(--sprint-color);'}`"></div>
      </div>
    </template>

    <!-- row headers -->
    <div class="row-headers" style="display: contents;">
      <!-- leave space + provide background for row headers -->
      <div id="row-headers-bg" style="grid-row: 1 / -1; min-width: 150px;"></div>
       <!-- let's also place some controls up top -->
      <div style="grid-row: 1 / 3; display: flex; flex-direction: column; justify-content: center;">
        <sl-range id="density-range" min="5" max="48" value="17" step="0.05" tooltip="none">
          <span slot="label" style="font-size: 0.75rem;">Density</span>
        </sl-range>
      </div>
      <div style="grid-row: 3 / 5; display: flex; flex-direction: column; justify-content: center;">
        <div id="jump-to-today-button" class="button" style="background: var(--today-color);">â†’ Today</div>
      </div>
      <div style="grid-row: 5 / 7; display: flex; flex-direction: row; align-items: start; gap: 12px;">
        <select id="fromYear-select" style="flex: 1; text-align: center; border: none; background: #3b3b3b; border-radius: 4px; -webkit-appearance:none;" x-effect="fromYear; toYear; $nextTick(() => $('#fromYear-select').val('' + fromYear));">
          <template x-for="year in range(new Date().getFullYear() - 5, toYear)">
            <option x-bind:value="year" x-text="year"></option>
          </template>
        </select>
        <select id="toYear-select" style="flex: 1; text-align: center; border: none; background: #3b3b3b; border-radius: 4px; -webkit-appearance:none;" x-effect="fromYear; toYear; $nextTick(() => $('#fromYear-select').val('' + fromYear));">
          <template x-for="year in range(fromYear, new Date().getFullYear() + 5)" x-effect="fromYear; toYear; $nextTick(() => $('#toYear-select').val('' + toYear));">
            <option x-bind:value="year" x-text="year"></option>
          </template>
        </select>
      </div>
      <!-- render each section -->
      <template x-for="section in sections">
        <template x-if="section.items.length">
          <div class="row-header-section" style="display: contents;">
            <!-- line items -->
            <template x-for="(item, itemIndex) in section.items">
              <div x-bind:class="'row-header ' + (item.header ? 'row-section-header' : '')" x-bind:style="`grid-row: ${item.index};`" x-text="item.text"></div>
            </template>
            <!-- top border-->
            <div class="section-top-border" x-bind:style="`position: static; z-index: 1; grid-row: ${section.items[0].index}; grid-column: 1 / ${lastColumn + 1};`"></div>
            <div class="section-top-border" x-bind:style="`grid-row: ${section.items[0].index};`"></div>
            <!-- bottom border -->
            <div class="section-bottom-border" x-bind:style="`position: static; z-index: 1; grid-row: ${section.items.slice(-1)[0].index}; grid-column: 1 / ${lastColumn + 1};`"></div>
            <div class="section-bottom-border" x-bind:style="`grid-row: ${section.items.slice(-1)[0].index};`"></div>
          </div>
        </template>
      </template>
    </div>

    <!-- highlight today's date -->
    <div id="today-column-background" x-bind:style="`grid-column: ${clampedColumn(fromYear, toYear, todayDate)}; grid-row: 6 / -1; background: var(--today-color); border: 1px solid var(--today-border-color); border-top: none; border-bottom: none; z-index: 5;`"></div>

    <!-- column at the end of the grid to hide overflows -->
    <div x-bind:style="`grid-column: ${column(fromYear, toYear, 12, 31) + 1}; grid-row: 1 / -1; background: rgb(50, 48, 47); z-index: 1000;`"></div>

  </div>

  <div slot="end" class="input">
    <textarea id="textarea"></textarea>
  </div>

  </sl-split-panel>
</main>
</body>

</html>
